<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test with Mock Data - Silent Auction</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            padding: 40px 20px;
            margin-bottom: 40px;
        }

        header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 30px;
            padding: 20px;
        }

        .item-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .item-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            background: #f0f0f0;
        }

        .item-content {
            padding: 20px;
        }

        .item-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .item-price {
            font-size: 1.5rem;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .price-label {
            font-size: 0.9rem;
            color: #666;
            font-weight: normal;
        }

        .bid-increment {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 15px;
        }

        .bidder-identifier {
            font-size: 1.2rem;
            color: white;
            background: red;
            padding: 15px 25px;
            border-radius: 8px;
            display: block;
            margin: 15px 0;
            font-weight: bold;
            text-align: center;
            border: 3px solid darkred;
            box-shadow: 0 4px 8px rgba(255, 0, 0, 0.3);
        }

        .item-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-bid {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .alert {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ§ª Test Page - Phone Identifiers</h1>
            <p>This page uses MOCK data to test the phone identifier feature</p>
        </header>

        <div class="alert">
            <strong>ðŸ“‹ Instructions:</strong> Open browser console (F12) to see debug logs. 
            This page simulates what happens when the Apps Script returns bid data with phone numbers.
        </div>

        <div class="items-grid" id="itemsGrid"></div>
    </div>

    <script>
        // Mock data simulating what Apps Script returns
        const MOCK_SERVER_RESPONSE = {
            "Soccer Ball": {
                bidAmount: 75,
                phone: "555-123-4567",
                fullName: "John Doe",
                timestamp: "2025-10-19T10:30:00"
            },
            "Signed Basketball": {
                bidAmount: 250,
                phone: "(555) 987-6543",
                fullName: "Jane Smith",
                timestamp: "2025-10-19T11:45:00"
            },
            "Artwork Print": {
                bidAmount: 150,
                phone: "5559998888",
                fullName: "Bob Johnson",
                timestamp: "2025-10-19T12:00:00"
            }
            // Note: Wine Collection, Golf Club Set, and Concert Tickets have NO bids yet
        };

        const items = [
            {
                id: 'item1',
                name: 'Soccer Ball',
                startingBid: 50,
                imageUrl: 'https://images.unsplash.com/photo-1614632537197-38a17061c2bd?w=400',
            },
            {
                id: 'item2',
                name: 'Signed Basketball',
                startingBid: 200,
                imageUrl: 'https://images.unsplash.com/photo-1546519638-68e109498ffc?w=400',
            },
            {
                id: 'item3',
                name: 'Artwork Print',
                startingBid: 100,
                imageUrl: 'https://images.unsplash.com/photo-1561214115-f2f134cc4912?w=400',
            },
            {
                id: 'item4',
                name: 'Wine Collection',
                startingBid: 250,
                imageUrl: 'https://images.unsplash.com/photo-1510812431401-41d2bd2722f3?w=400',
            },
            {
                id: 'item5',
                name: 'Golf Club Set',
                startingBid: 300,
                imageUrl: 'https://images.unsplash.com/photo-1535131749006-b7f58c99034b?w=400',
            },
            {
                id: 'item6',
                name: 'Concert Tickets',
                startingBid: 400,
                imageUrl: 'https://images.unsplash.com/photo-1470229722913-7c0e2dbbafd3?w=400',
            }
        ];

        let currentBids = {};

        function getBidAmount(bidData, defaultValue) {
            if (!bidData) return defaultValue;
            if (typeof bidData === 'object' && bidData.bidAmount !== undefined) {
                return Number(bidData.bidAmount);
            }
            if (typeof bidData === 'number') {
                return bidData;
            }
            return defaultValue;
        }

        function getPhoneIdentifier(bidData) {
            console.log('getPhoneIdentifier called with:', bidData);
            if (!bidData || typeof bidData !== 'object') {
                console.log('No bidData or not an object');
                return null;
            }
            if (!bidData.phone) {
                console.log('No phone field in bidData');
                return null;
            }
            const phone = String(bidData.phone);
            console.log('Phone number:', phone);
            const digitsOnly = phone.replace(/\D/g, '');
            if (digitsOnly.length >= 4) {
                const last4 = digitsOnly.slice(-4);
                const result = { text: `***-${last4}` };
                console.log('Returning phone identifier:', result);
                return result;
            }
            console.log('Not enough digits in phone');
            return null;
        }

        function getMinimumBidIncrement(currentBid) {
            if (currentBid < 100) return 5;
            if (currentBid < 500) return 10;
            return 25;
        }

        function renderItems() {
            console.log('ðŸŽ¨ Rendering items with currentBids:', currentBids);
            const grid = document.getElementById('itemsGrid');
            grid.innerHTML = items.map(item => {
                const bidData = currentBids[item.name];
                const currentBid = getBidAmount(bidData, item.startingBid);
                const increment = getMinimumBidIncrement(currentBid);
                const minNextBid = currentBid + increment;
                const phoneData = getPhoneIdentifier(bidData);
                const phoneHtml = phoneData ? `<div class="bidder-identifier">${phoneData.text}</div>` : '';
                
                console.log(`Item: ${item.name}, Has phone: ${phoneData ? 'YES' : 'NO'}`);
                
                return `
                <div class="item-card">
                    <img src="${item.imageUrl}" alt="${item.name}" class="item-image">
                    <div class="item-content">
                        <div class="item-title">${item.name}</div>
                        <div class="item-price">
                            <span class="price-label">Current Bid: </span>
                            <span>$${currentBid}</span>
                        </div>
                        <div class="bid-increment">Next minimum bid: $${minNextBid}</div>
                        <div id="phone-${item.id}" style="margin-bottom: 10px;">${phoneHtml}</div>
                        <div class="item-buttons">
                            <button class="btn btn-bid">Bid Now</button>
                        </div>
                    </div>
                </div>
            `}).join('');
        }

        function loadMockData() {
            console.log('ðŸ“Š Loading mock server data:', MOCK_SERVER_RESPONSE);
            currentBids = MOCK_SERVER_RESPONSE;
            renderItems();
        }

        // Initialize
        console.log('ðŸš€ Initializing test page...');
        loadMockData();
        
        console.log('âœ… Test page ready! Check the items above - 3 should have phone identifiers, 3 should not.');
    </script>
</body>
</html>
